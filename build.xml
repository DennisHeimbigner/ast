<?xml version="1.0"?>
<project name="ast.compiler" default="all" basedir=".">

<!-- Compiler Settings -->
<property name="compile.deprecation"	value="off"/>

<!-- Project directories -->
<property name="src.main.dir"		location="src"/>
<property name="src.test.dir"		location="src/test"/>

<property name="doc.dir"	location="doc"/>
<property name="lib.dir"	location="lib"/>
<!--property name="bin.dir"	location="bin"/ -->
<!--property name="dist.dir"	location="dist"/ -->
<property name="resources.dir"	location="${src.main.dir}/resources"/>
<property name="schema.dir"	location="schema"/>
<property name="testsuites.dir" location="${src.test.dir}/testsuites"/>
<property name="buildfiles.dir" location="target"/>

<!-- Build Directories -->
<property name="build.dir"	location="build"/>
<property name="build.classes"	location="${build.dir}/classes"/>
<property name="build.doc"	location="${build.dir}/doc"/>
<property name="build.lib"	location="${build.dir}/lib"/>

<!-- Where to put test case output -->
<property name="results.dir"	location="${build.dir}/results"/>

<!-- jar files -->
<property name="protobufjar" value="protobuf.jar"/>
<property name="main.class" value="unidata.protobuf.ast.compiler.Main"/>

<available file="t:/JetBrains/IntelliJ IDEA Community Edition 9.0.3/lib/junit.jar"
           property="junitjar" value="t:/JetBrains/IntelliJ IDEA Community Edition 9.0.3/lib/junit.jar"/>

<available file="C:/Program Files (x86)/JetBrains/IntelliJ IDEA 9.0.2/lib/junit.jar"
           property="junitjar" value="C:/Program Files (x86)/JetBrains/IntelliJ IDEA 9.0.2/lib/junit.jar"/>


<!-- BUILD TASKS  -->

<target name="all" depends="init,compiler"/>

<!--
- Target "init" prepares (creates if neccessary)
- the build dircteory tree.
-->
<target name="init" description="Prepare all build directories.">
    <mkdir dir="${build.dir}"/>
    <mkdir dir="${build.lib}"/>
    <mkdir dir="${build.classes}"/>
    <mkdir dir="${build.doc}"/>
    <mkdir dir="${results.dir}"/>
    <!--tstamp -->
    <echo level="info" message="time: ${TSTAMP}"/>
</target>

<target name="compiletests">
    <javac
	destdir="${build.classes}"
	includeAntRuntime="false"
	deprecation="${compile.deprecation}"
	classpath="${build.classes}:${junitjar}">
	<src path="${src.test.dir}"/>
	<include name="*.java"/>
    </javac>
</target>

<target name="test" depends="compiletests">
    <java classname="unidata.protobuf.ast.test.TestAST"
          classpath="${build.classes}:${junitjar}"/>
</target>

<target name="generate" depends="compiletests">
    <java classname="unidata.protobuf.test.TestAST"
          classpath="${build.classes}:${junitjar}">
        <arg value="-generate"/>
    </java>
</target>

<target name="compiler" depends="init">
    <javac
	destdir="${build.classes}"
	classpath="${build.classes}"
	includeAntRuntime="false"
	deprecation="${compile.deprecation}">
	<src path="${src.main.dir}"/>
	<include name="compiler/*.java"/>
	<include name="Java/*.java"/>
    </javac>
    <jar destfile="${build.dir}/${protobufjar}" basedir="${build.classes}">
	<manifest>
	<attribute name="Manifest-Version" value="1.0"/>
	<attribute name="Main-class" value="${main.class}"/>
	</manifest>
    </jar>
</target>

<target name="clean">
    <delete includeemptydirs="true" failonerror="false">
        <fileset dir="${build.dir}"/>
    </delete>
</target>

</project>
